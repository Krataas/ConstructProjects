name: Build All Eco Plugins

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:
    inputs:
      plugin:
        description: 'Which plugin to build (or "all")'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - EcoEnchants
          - EcoItems
          - EcoSkills
          - EcoJobs
          - EcoArmor

jobs:
  build-dependencies:
    runs-on: ubuntu-latest
    outputs:
      libreforge-version: ${{ steps.versions.outputs.libreforge }}
      eco-version: ${{ steps.versions.outputs.eco }}
    
    steps:
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: 'gradle'
    
    # Build eco (core library)
    - name: Checkout eco Repository
      uses: actions/checkout@v4
      with:
        repository: Auxilor/eco
        path: eco
        submodules: recursive
    
    - name: Build eco
      working-directory: ./eco
      run: |
        chmod +x gradlew
        ./gradlew build publishToMavenLocal --no-daemon
    
    - name: Get eco version
      id: get_eco_version
      working-directory: ./eco
      run: |
        VERSION=$(./gradlew properties --no-daemon | grep "^version:" | awk '{print $2}')
